<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Repository File Tree</title>
  <style>
    /* Dark Theme Styling */
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
    }
    h1 {
      color: #ffffff;
    }
    ul {
      list-style: none;
      padding-left: 20px;
    }
    li {
      margin: 5px 0;
      cursor: pointer;
      user-select: none;
    }
    .folder::before {
      content: 'üìÅ ';
    }
    .file::before {
      content: 'üìÑ ';
    }
    /* Hidden class for collapsible folders */
    .hidden {
      display: none;
    }
    /* Optional: Highlight folder on hover */
    .folder:hover {
      color: #bb86fc;
    }
  </style>
</head>
<body>
  <h1>Repository File Tree</h1>
  <div id="file-tree">Loading repository file tree...</div>

  <script>
    // Repository details
    const owner = 'ctforion';
    const repo = 'ctforion.github.io';
    const branch = 'master'; // Change this if your default branch is different

    // GitHub API endpoint to fetch the repository tree recursively
    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;

    // Fetch the repository tree from GitHub
    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        if (data.tree) {
          const treeData = buildTree(data.tree);
          const treeHTML = renderTree(treeData);
          document.getElementById('file-tree').innerHTML = treeHTML;
          addToggleEventListeners();
        } else {
          document.getElementById('file-tree').innerText = "Error: Unable to fetch repository tree.";
        }
      })
      .catch(error => {
        console.error('Error fetching repository tree:', error);
        document.getElementById('file-tree').innerText = "Error fetching repository tree.";
      });

    // Build a nested tree structure from the flat list provided by GitHub
    function buildTree(items) {
      const tree = {};
      items.forEach(item => {
        const parts = item.path.split('/');
        let current = tree;
        parts.forEach((part, index) => {
          if (!current[part]) {
            current[part] = { __meta__: { type: (index === parts.length - 1) ? item.type : 'tree' } };
          }
          current = current[part];
        });
      });
      return tree;
    }

    // Recursively render the tree as HTML nested lists
    function renderTree(tree) {
      let html = '<ul>';
      for (const key in tree) {
        if (key === '__meta__') continue;
        const node = tree[key];
        const type = node.__meta__.type;
        if (type === 'tree') {
          html += `<li class="folder">${key}`;
          // Only render children if available
          if (Object.keys(node).length > 1) {
            html += renderTree(node);
          }
          html += '</li>';
        } else { // type === 'blob'
          // For files, you might eventually add a link to view the file online
          html += `<li class="file">${key}</li>`;
        }
      }
      html += '</ul>';
      return html;
    }

    // Add click event listeners to folders to toggle visibility of nested lists
    function addToggleEventListeners() {
      const folders = document.getElementsByClassName('folder');
      Array.from(folders).forEach(folder => {
        folder.addEventListener('click', function(e) {
          // Prevent clicks from bubbling up to parent folders
          e.stopPropagation();
          const childUl = this.querySelector('ul');
          if (childUl) {
            childUl.classList.toggle('hidden');
          }
        });
      });
    }
  </script>
</body>
</html>
